<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=generator content="Hugo 0.101.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>Subscribe to Messages from a Topic &#183; Go Development Kit</title><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Source+Code+Pro|Work+Sans:400,700"><link type=text/css rel=stylesheet href=../../../css/syntax.css><link type=text/css rel=stylesheet href=../../../css/style.css><link rel="shortcut icon" href=../../../favicon-32x32.png></head><body><div class=PageLayout><header class=PageHeader><a href><h1 class=PageLogo><img class=PageLogo-image src=../../../go-cdk-logo-white.png alt="Go Development Kit"></h1></a></header><main class=MainContent><div class=MainContent-bounds><h1>Subscribe to Messages from a Topic</h1><nav class=PageTOC><div class=PageTOC-heading>In this article</div><nav id=TableOfContents><ul><li><a href=#opening>Opening a Subscription</a></li><li><a href=#receiving>Receiving and Acknowledging Messages</a></li><li><a href=#other-usage-samples>Other Usage Samples</a></li><li><a href=#services>Supported Pub/Sub Services</a><ul><li><a href=#rabbitmq>RabbitMQ</a></li><li><a href=#nats>NATS</a></li><li><a href=#kafka>Kafka</a></li><li><a href=#mem>In-Memory</a></li><li><a href=#redis>Redis</a></li><li><a href=#pulsar>Pulsar</a></li></ul></li></ul></nav></nav><p>Subscribing to receive message from a topic with the GDK takes three steps:</p><ol><li><a href=#opening>Open a subscription</a> to a topic with the Pub/Sub service of your choice (once per
subscription).</li><li><a href=#receiving>Receive and acknowledge messages</a> from the topic. After completing any
work related to the message, use the Ack method to prevent it from being
redelivered.</li></ol><h2 id=opening>Opening a Subscription<a class=anchor href=#opening aria-label="Link to Section">ðŸ”—</a></h2><p>The first step in subscribing to receive messages from a topic is
to instantiate a portable <a href=https://godoc.org/github.com/sraphs/gdk/pubsub#Subscription><code>*pubsub.Subscription</code></a> for your service.</p><p>The easiest way to do so is to use <a href=https://godoc.org/github.com/sraphs/gdk/pubsub#OpenTopic><code>pubsub.OpenSubscription</code></a>
and a service-specific URL pointing to the topic, making sure you
<a href=https://golang.org/doc/effective_go.html#blank_import>&ldquo;blank import&rdquo;</a> the driver package to link it in.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;github.com/sraphs/gdk/pubsub&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/pubsub/&lt;driver&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>ctx</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>subs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;&lt;driver-url&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;could not open topic subscription: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subs</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// subs is a *pubsub.Subscription; see usage below
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>...</span>
</span></span></code></pre></div><p>See <a href=../../../concepts/urls/>Concepts: URLs</a> for general background and the <a href=#services>guide below</a>
for URL usage for each supported service.</p><p>Alternatively, if you need fine-grained
control over the connection settings, you can call the constructor function in
the driver package directly (like <code>gcppubsub.OpenSubscription</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/sraphs/gdk/pubsub/&lt;driver&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>subs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=p>&lt;</span><span class=nx>driver</span><span class=p>&gt;.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p>You may find the <a href=http://github.com/google/wire><code>wire</code> package</a> useful for managing your initialization code
when switching between different backing services.</p><p>See the <a href=#services>guide below</a> for constructor usage for each supported service.</p><h2 id=receiving>Receiving and Acknowledging Messages<a class=anchor href=#receiving aria-label="Link to Section">ðŸ”—</a></h2><p>A simple subscriber that operates on
<a href=https://godoc.org/github.com/sraphs/gdk/pubsub#Message>messages</a> serially looks like
this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Loop on received messages.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>msg</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Receive</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Errors from Receive indicate that Receive will no longer succeed.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Receiving message: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Do work based on the message, for example:
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Got message: %q\n&#34;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>Body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Messages must always be acknowledged with Ack.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>msg</span><span class=p>.</span><span class=nf>Ack</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If you want your subscriber to operate on incoming messages concurrently,
you can start multiple goroutines:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Loop on received messages. We can use a channel as a semaphore to limit how
</span></span></span><span class=line><span class=cl><span class=c1>// many goroutines we have active at a time as well as wait on the goroutines
</span></span></span><span class=line><span class=cl><span class=c1>// to finish before exiting.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>const</span> <span class=nx>maxHandlers</span> <span class=p>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=nx>sem</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kd>struct</span><span class=p>{},</span> <span class=nx>maxHandlers</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>recvLoop</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>msg</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Receive</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Errors from Receive indicate that Receive will no longer succeed.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Receiving message: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Wait if there are too many active handle goroutines and acquire the
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// semaphore. If the context is canceled, stop waiting and start shutting
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// down.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=nx>sem</span> <span class=o>&lt;-</span> <span class=kd>struct</span><span class=p>{}{}:</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=o>&lt;-</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Done</span><span class=p>():</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span> <span class=nx>recvLoop</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Handle the message in a new goroutine.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>defer</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span> <span class=o>&lt;-</span><span class=nx>sem</span> <span class=p>}()</span> <span class=c1>// Release the semaphore.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>defer</span> <span class=nx>msg</span><span class=p>.</span><span class=nf>Ack</span><span class=p>()</span>          <span class=c1>// Messages must always be acknowledged with Ack.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>		<span class=c1>// Do work based on the message, for example:
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Got message: %q\n&#34;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>.</span><span class=nx>Body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// We&#39;re no longer receiving messages. Wait to finish handling any
</span></span></span><span class=line><span class=cl><span class=c1>// unacknowledged messages by totally acquiring the semaphore.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=nx>n</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>n</span> <span class=p>&lt;</span> <span class=nx>maxHandlers</span><span class=p>;</span> <span class=nx>n</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>sem</span> <span class=o>&lt;-</span> <span class=kd>struct</span><span class=p>{}{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Note that the <a href=https://godoc.org/github.com/sraphs/gdk/pubsub#hdr-At_most_once_and_At_least_once_Delivery>semantics of message delivery</a> can vary by backing service.</p><h2 id=other-usage-samples>Other Usage Samples<a class=anchor href=#other-usage-samples aria-label="Link to Section">ðŸ”—</a></h2><ul><li><a href=https://github.com/sraphs/gdk/tree/master/samples/gocdk-pubsub>CLI Sample</a></li><li><a href=https://github.com/sraphs/gdk/tutorials/order/>Order Processor sample</a></li><li><a href=https://godoc.org/github.com/sraphs/gdk/pubsub#pkg-examples>pubsub package examples</a></li></ul><h2 id=services>Supported Pub/Sub Services<a class=anchor href=#services aria-label="Link to Section">ðŸ”—</a></h2><h3 id=rabbitmq>RabbitMQ<a class=anchor href=#rabbitmq aria-label="Link to Section">ðŸ”—</a></h3><p>The GDK can receive messages from an <a href=https://www.rabbitmq.com/protocol.html>AMQP 0.9.1</a> queue, the dialect of
AMQP spoken by <a href=https://www.rabbitmq.com>RabbitMQ</a>. A RabbitMQ URL only includes the queue name.
The RabbitMQ&rsquo;s server is discovered from the <code>RABBIT_SERVER_URL</code> environment
variable (which is something like <code>amqp://guest:guest@localhost:5672/</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/pubsub/rabbitpubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// pubsub.OpenSubscription creates a *pubsub.Subscription from a URL.
</span></span></span><span class=line><span class=cl><span class=c1>// This URL will Dial the RabbitMQ server at the URL in the environment
</span></span></span><span class=line><span class=cl><span class=c1>// variable RABBIT_SERVER_URL and open the queue &#34;myqueue&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subscription</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;rabbit://myqueue&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=rabbitmq-ctor>RabbitMQ Constructor<a class=anchor href=#rabbitmq-ctor aria-label="Link to Section">ðŸ”—</a></h4><p>The <a href=https://godoc.org/github.com/sraphs/gdk/pubsub/rabbitpubsub#OpenSubscription><code>rabbitpubsub.OpenSubscription</code></a> constructor opens a RabbitMQ queue.
You must first create an <a href=https://pkg.go.dev/github.com/rabbitmq/amqp091-go#Connection><code>*amqp.Connection</code></a> to your RabbitMQ instance.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>amqp</span> <span class=s>&#34;github.com/rabbitmq/amqp091-go&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub/rabbitpubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>rabbitConn</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>amqp</span><span class=p>.</span><span class=nf>Dial</span><span class=p>(</span><span class=s>&#34;amqp://guest:guest@localhost:5672/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>rabbitConn</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>subscription</span> <span class=o>:=</span> <span class=nx>rabbitpubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=nx>rabbitConn</span><span class=p>,</span> <span class=s>&#34;myqueue&#34;</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=nats>NATS<a class=anchor href=#nats aria-label="Link to Section">ðŸ”—</a></h3><p>The GDK can publish to a <a href=https://nats.io/>NATS</a> subject. A NATS URL only includes the
subject name. The NATS server is discovered from the <code>NATS_SERVER_URL</code>
environment variable (which is something like <code>nats://nats.example.com</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/pubsub/natspubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// pubsub.OpenSubscription creates a *pubsub.Subscription from a URL.
</span></span></span><span class=line><span class=cl><span class=c1>// This URL will Dial the NATS server at the URL in the environment variable
</span></span></span><span class=line><span class=cl><span class=c1>// NATS_SERVER_URL and receive messages with subject &#34;example.my-subject&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subscription</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;nats://example.my-subject&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><p>NATS guarantees at-most-once delivery; it will never redeliver a message.
Therefore, <code>Message.Ack</code> is a no-op.</p><p>To parse messages <a href=../../../howto/pubsub/publish/#nats>published via the GDK</a>, the NATS driver
will first attempt to decode the payload using <a href=https://golang.org/pkg/encoding/gob/>gob</a>. Failing that, it will
return the message payload as the <code>Data</code> with no metadata to accomodate
subscribing to messages coming from a source not using the GDK.</p><h4 id=nats-ctor>NATS Constructor<a class=anchor href=#nats-ctor aria-label="Link to Section">ðŸ”—</a></h4><p>The <a href=https://godoc.org/github.com/sraphs/gdk/pubsub/natspubsub#OpenSubscription><code>natspubsub.OpenSubscription</code></a> constructor opens a NATS subject as a
topic. You must first create an <a href=https://godoc.org/github.com/nats-io/go-nats#Conn><code>*nats.Conn</code></a> to your NATS instance.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/nats-io/nats.go&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub/natspubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>natsConn</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>nats</span><span class=p>.</span><span class=nf>Connect</span><span class=p>(</span><span class=s>&#34;nats://nats.example.com&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>natsConn</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>subscription</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>natspubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>natsConn</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;example.my-subject&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=kafka>Kafka<a class=anchor href=#kafka aria-label="Link to Section">ðŸ”—</a></h3><p>The GDK can receive messages from a <a href=https://kafka.apache.org/>Kafka</a> cluster.
A Kafka URL includes the consumer group name, plus at least one instance
of a query parameter specifying the topic to subscribe to.
The brokers in the Kafka cluster are discovered from the
<code>KAFKA_BROKERS</code> environment variable (which is a comma-delimited list of
hosts, something like <code>1.2.3.4:9092,5.6.7.8:9092</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/pubsub/kafkapubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// pubsub.OpenSubscription creates a *pubsub.Subscription from a URL.
</span></span></span><span class=line><span class=cl><span class=c1>// The host + path are used as the consumer group name.
</span></span></span><span class=line><span class=cl><span class=c1>// The &#34;topic&#34; query parameter sets one or more topics to subscribe to.
</span></span></span><span class=line><span class=cl><span class=c1>// The set of brokers must be in an environment variable KAFKA_BROKERS.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subscription</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;kafka://my-group?topic=my-topic&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=kafka-ctor>Kafka Constructor<a class=anchor href=#kafka-ctor aria-label="Link to Section">ðŸ”—</a></h4><p>The <a href=https://godoc.org/github.com/sraphs/gdk/pubsub/kafkapubsub#OpenSubscription><code>kafkapubsub.OpenSubscription</code></a> constructor creates a consumer in a
consumer group, subscribed to one or more topics.</p><p>In addition to the list of brokers, you&rsquo;ll need a <a href=https://godoc.org/github.com/Shopify/sarama#Config><code>*sarama.Config</code></a>, which
exposes many knobs that can affect performance and semantics; review and set
them carefully. <a href=https://godoc.org/github.com/sraphs/gdk/pubsub/kafkapubsub#MinimalConfig><code>kafkapubsub.MinimalConfig</code></a> provides a minimal config to
get you started.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub/kafkapubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The set of brokers in the Kafka cluster.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>addrs</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;1.2.3.4:9092&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// The Kafka client configuration to use.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>config</span> <span class=o>:=</span> <span class=nx>kafkapubsub</span><span class=p>.</span><span class=nf>MinimalConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Construct a *pubsub.Subscription, joining the consumer group &#34;my-group&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// and receiving messages from &#34;my-topic&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subscription</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>kafkapubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>addrs</span><span class=p>,</span> <span class=nx>config</span><span class=p>,</span> <span class=s>&#34;my-group&#34;</span><span class=p>,</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;my-topic&#34;</span><span class=p>},</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=mem>In-Memory<a class=anchor href=#mem aria-label="Link to Section">ðŸ”—</a></h3><p>The GDK includes an in-memory Pub/Sub provider useful for local testing.
The names in <code>mem://</code> URLs are a process-wide namespace, so subscriptions to
the same name will receive messages posted to that topic. For instance, if
you open a topic <code>mem://topicA</code> and open two subscriptions with
<code>mem://topicA</code>, you will have two subscriptions to the same topic.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/pubsub/mempubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create a topic.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>topic</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pubsub</span><span class=p>.</span><span class=nf>OpenTopic</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;mem://topicA&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>topic</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create a subscription connected to that topic.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subscription</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;mem://topicA&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=mem-ctor>In-Memory Constructor<a class=anchor href=#mem-ctor aria-label="Link to Section">ðŸ”—</a></h4><p>To create a subscription to an in-memory Pub/Sub topic, pass the <a href=../../../howto/pubsub/publish/#mem-ctor>topic you
created</a> into the <a href=https://godoc.org/github.com/sraphs/gdk/pubsub/mempubsub#NewSubscription><code>mempubsub.NewSubscription</code> function</a>.
You will also need to pass an acknowledgement deadline: once a message is
received, if it is not acknowledged after the deadline elapses, then it will be
redelivered.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub/mempubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Construct a *pubsub.Topic.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>topic</span> <span class=o>:=</span> <span class=nx>mempubsub</span><span class=p>.</span><span class=nf>NewTopic</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>topic</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Construct a *pubsub.Subscription for the topic.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subscription</span> <span class=o>:=</span> <span class=nx>mempubsub</span><span class=p>.</span><span class=nf>NewSubscription</span><span class=p>(</span><span class=nx>topic</span><span class=p>,</span> <span class=mi>1</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Minute</span> <span class=cm>/* ack deadline */</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=redis>Redis<a class=anchor href=#redis aria-label="Link to Section">ðŸ”—</a></h3><p>The GDK can publish to a <a href=https://redis.io/>Redis</a> subject. A Redis URL only includes the
subject name. The Redis server is discovered from the <code>REDIS_SERVER_URL</code>
environment variable (which is something like <code>redis://redis.example.com</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/pubsub/redispubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// pubsub.OpenSubscription creates a *pubsub.Subscription from a URL.
</span></span></span><span class=line><span class=cl><span class=c1>// This URL will Dial the Redis server at the URL in the environment variable
</span></span></span><span class=line><span class=cl><span class=c1>// REDIS_SERVER_URL and receive messages with subject &#34;example.my-topic&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subscription</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;redis://example.my-topic&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><p>Because Redis does not natively support metadata, messages sent to Redis will
be encoded with <a href=https://golang.org/pkg/encoding/gob/>gob</a>.</p><h4 id=redis-ctor>Redis Constructor<a class=anchor href=#redis-ctor aria-label="Link to Section">ðŸ”—</a></h4><p>The <a href=https://godoc.org/github.com/sraphs/gdk/pubsub/redispubsub#OpenSubscription><code>redispubsub.OpenSubscription</code></a> constructor opens a Redis subject as a topic. You
must first create an <a href=https://godoc.org/github.com/go-redis/redis/v8#Client><code>*redis.Client</code></a> to your Redis instance.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/go-redis/redis/v8&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub/redispubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>opt</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>redis</span><span class=p>.</span><span class=nf>ParseURL</span><span class=p>(</span><span class=s>&#34;redis://localhost:6379&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>client</span> <span class=o>:=</span> <span class=nx>redis</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=nx>opt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>subscription</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>redispubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=nx>client</span><span class=p>,</span> <span class=s>&#34;example.my-topic&#34;</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=pulsar>Pulsar<a class=anchor href=#pulsar aria-label="Link to Section">ðŸ”—</a></h3><p>The GDK can publish to a <a href=https://pulsar.apache.org/>Pulsar</a> subject. A Pulsar URL only includes the
subject name. The Pulsar server is discovered from the <code>Pulsar_SERVER_URL</code>
environment variable (which is something like <code>pulsar://localhost:6650</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/pubsub/pulsarpubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// pubsub.OpenSubscription creates a *pubsub.Subscription from a URL.
</span></span></span><span class=line><span class=cl><span class=c1>// The host + path are used as the consumer group name.
</span></span></span><span class=line><span class=cl><span class=c1>// The &#34;topic&#34; query parameter sets one or more topics to subscribe to.
</span></span></span><span class=line><span class=cl><span class=c1>// The set of brokers must be in an environment variable KAFKA_BROKERS.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subscription</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;pulsar://my-sub?topic=my-topic&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=pulsar-ctor>Pulsar Constructor<a class=anchor href=#pulsar-ctor aria-label="Link to Section">ðŸ”—</a></h4><p>The <a href=https://godoc.org/github.com/sraphs/gdk/pubsub/pulsarpubsub#OpenSubscription><code>pulsarpubsub.OpenSubscription</code></a> constructor opens a Pulsar topic to publish
messages to.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/apache/pulsar-client-go/pulsar&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/pubsub/pulsarpubsub&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>localPulsarURL</span> <span class=o>:=</span> <span class=s>&#34;pulsar://localhost:6650&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>config</span> <span class=o>:=</span> <span class=nx>pulsarpubsub</span><span class=p>.</span><span class=nf>MinimalConfig</span><span class=p>(</span><span class=nx>localPulsarURL</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pulsar</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// Construct a *pubsub.Subscription, use the SubscriptionName &#34;my-sub&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// and receiving messages from &#34;my-topic&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>subscription</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>pulsarpubsub</span><span class=p>.</span><span class=nf>OpenSubscription</span><span class=p>(</span><span class=nx>client</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pulsarpubsub</span><span class=p>.</span><span class=nx>SubscriptionOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ConsumerOptions</span><span class=p>:</span> <span class=nx>pulsar</span><span class=p>.</span><span class=nx>ConsumerOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Topic</span><span class=p>:</span>            <span class=s>&#34;my-topic&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>SubscriptionName</span><span class=p>:</span> <span class=s>&#34;my-sub&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nx>KeyName</span><span class=p>:</span> <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>subscription</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span></code></pre></div></div></main><nav class=Sidenav><ul class=Sidenav-list><li class=Sidenav-section><a href=../../../ class=Sidenav-sectionLink>Home</a></li><li class=Sidenav-section><a href=../../../howto/ class=Sidenav-sectionLink>How-To Guides</a><ul class=Sidenav-pageList><li class=Sidenav-page><a href=../../../howto/blob/ class=Sidenav-pageLink>Blob</a></li><li class=Sidenav-page><a href=../../../howto/pubsub/ class=Sidenav-pageLink>Pub/Sub</a></li><li class=Sidenav-page><a href=../../../howto/runtimevar/ class=Sidenav-pageLink>Runtime Configuration</a></li><li class=Sidenav-page><a href=../../../howto/secrets/ class=Sidenav-pageLink>Secrets</a></li></ul></li><li class=Sidenav-section><a href=../../../concepts/ class=Sidenav-sectionLink>Concepts</a><ul class=Sidenav-pageList><li class=Sidenav-page><a href=../../../concepts/structure/ class=Sidenav-pageLink>Structuring Portable Code</a></li><li class=Sidenav-page><a href=../../../concepts/urls/ class=Sidenav-pageLink>URLs</a></li><li class=Sidenav-page><a href=../../../concepts/as/ class=Sidenav-pageLink>Using provider-specific APIs</a></li></ul></li></ul></nav><footer class=PageFooter><nav><ul class=FooterLinks><li class=FooterLinks-item><a href=https://github.com/sraphs/gdk/ class=FooterLinks-link>GitHub</a></li><li class=FooterLinks-item><a href=https://github.com/sraphs/gdk/issues class=FooterLinks-link>Contact Team</a></li></ul></nav><p class=PageFooter-paragraph>Copyright Â© 2022-2022 The Go Development Kit Authors.</p><p class=PageFooter-paragraph>All content released under an <a href=https://github.com/sraphs/gdk/blob/main/LICENSE target=_blank class=PageFooter-link>MIT License</a>.</p></footer></div></body></html>