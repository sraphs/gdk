<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=generator content="Hugo 0.101.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>Blob &#183; Go Development Kit</title><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Source+Code+Pro|Work+Sans:400,700"><link type=text/css rel=stylesheet href=../../css/syntax.css><link type=text/css rel=stylesheet href=../../css/style.css><link rel="shortcut icon" href=../../favicon-32x32.png></head><body><div class=PageLayout><header class=PageHeader><a href><h1 class=PageLogo><img class=PageLogo-image src=../../go-cdk-logo-white.png alt="Go Development Kit"></h1></a></header><main class=MainContent><div class=MainContent-bounds><h1>Blob</h1><nav class=PageTOC><div class=PageTOC-heading>In this article</div><nav id=TableOfContents><ul><li><a href=#opening>Opening a Bucket</a><ul><li><a href=#prefix>Prefixed Buckets</a></li><li><a href=#singlekey>Single Key Buckets</a></li></ul></li><li><a href=#using>Using a Bucket</a><ul><li><a href=#writing>Writing Data to a Bucket</a></li><li><a href=#reading>Reading Data from a Bucket</a></li><li><a href=#deleting>Deleting a Bucket</a></li></ul></li><li><a href=#services>Supported Storage Services</a><ul><li><a href=#s3>S3</a></li><li><a href=#local>Local Storage</a></li></ul></li></ul></nav></nav><p>Blobs are a common abstraction for storing unstructured data on Cloud storage
services and accessing them via HTTP. This guide shows how to work with
blobs in the Go CDK.</p><p>The <a href=https://godoc.org/github.com/sraphs/gdk/blob><code>blob</code> package</a> supports operations like reading and writing blobs (using standard
<a href=https://golang.org/pkg/io/><code>io</code> package</a> interfaces), deleting blobs, and listing blobs in a bucket.</p><p>Subpackages contain driver implementations of blob for various services,
including Cloud and on-prem solutions. You can develop your application
locally using <a href=https://godoc.org/github.com/sraphs/gdk/blob/fileblob><code>fileblob</code></a>, then deploy it to multiple Cloud providers with
minimal initialization reconfiguration.</p><h2 id=opening>Opening a Bucket<a class=anchor href=#opening aria-label="Link to Section">ðŸ”—</a></h2><p>The first step in interacting with unstructured storage is
to instantiate a portable <a href=https://godoc.org/github.com/sraphs/gdk/blob#Bucket><code>*blob.Bucket</code></a> for your storage service.</p><p>The easiest way to do so is to use <a href=https://godoc.org/github.com/sraphs/gdk/blob#OpenBucket><code>blob.OpenBucket</code></a> and a service-specific URL
pointing to the bucket, making sure you <a href=https://golang.org/doc/effective_go.html#blank_import>&ldquo;blank import&rdquo;</a> the driver package to
link it in.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/blob&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/blob/&lt;driver&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>bucket</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>blob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=s>&#34;&lt;driver-url&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;could not open bucket: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>// bucket is a *blob.Bucket; see usage below
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>...</span>
</span></span></code></pre></div><p>See <a href=../../concepts/urls/>Concepts: URLs</a> for general background and the <a href=#services>guide below</a> for URL usage
for each supported service.</p><p>Alternatively, if you need
fine-grained control over the connection settings, you can call the constructor
function in the driver package directly.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/sraphs/gdk/blob/&lt;driver&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>bucket</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=p>&lt;</span><span class=nx>driver</span><span class=p>&gt;.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p>You may find the <a href=http://github.com/google/wire><code>wire</code> package</a> useful for managing your initialization code
when switching between different backing services.</p><p>See the <a href=#services>guide below</a> for constructor usage for each supported service.</p><h3 id=prefix>Prefixed Buckets<a class=anchor href=#prefix aria-label="Link to Section">ðŸ”—</a></h3><p>You can wrap a <code>*blob.Bucket</code> to always operate on a subfolder of the bucket
using <code>blob.PrefixedBucket</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/sraphs/gdk/blob&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Wrap the bucket using blob.PrefixedBucket.
</span></span></span><span class=line><span class=cl><span class=c1>// The prefix should end with &#34;/&#34;, so that the resulting bucket operates
</span></span></span><span class=line><span class=cl><span class=c1>// in a subfolder.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>bucket</span> <span class=p>=</span> <span class=nx>blob</span><span class=p>.</span><span class=nf>PrefixedBucket</span><span class=p>(</span><span class=nx>bucket</span><span class=p>,</span> <span class=s>&#34;a/subfolder/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The original bucket is no longer usable; it has been closed.
</span></span></span><span class=line><span class=cl><span class=c1>// The wrapped bucket should be closed when done.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>defer</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Bucket operations on &lt;key&gt; will be translated to &#34;a/subfolder/&lt;key&gt;&#34;.
</span></span></span></code></pre></div><p>Alternatively, you can configure the prefix directly in the <code>blob.OpenBucket</code>
URL:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/blob&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Connect to a bucket using a URL, using the &#34;prefix&#34; query parameter to
</span></span></span><span class=line><span class=cl><span class=c1>// target a subfolder in the bucket.
</span></span></span><span class=line><span class=cl><span class=c1>// The prefix should end with &#34;/&#34;, so that the resulting bucket operates
</span></span></span><span class=line><span class=cl><span class=c1>// in a subfolder.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>b</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>blob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;mem://?prefix=a/subfolder/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>b</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Bucket operations on &lt;key&gt; will be translated to &#34;a/subfolder/&lt;key&gt;&#34;.
</span></span></span></code></pre></div><h3 id=singlekey>Single Key Buckets<a class=anchor href=#singlekey aria-label="Link to Section">ðŸ”—</a></h3><p>You can wrap a <code>*blob.Bucket</code> to always operate on a single key
using <code>blob.SingleKeyBucket</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/sraphs/gdk/blob&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Wrap the bucket using blob.SingleKeyBucket.
</span></span></span><span class=line><span class=cl><span class=c1>// The bucket always references the provided key.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>bucket</span> <span class=p>=</span> <span class=nx>blob</span><span class=p>.</span><span class=nf>SingleKeyBucket</span><span class=p>(</span><span class=nx>bucket</span><span class=p>,</span> <span class=s>&#34;foo.txt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The original bucket is no longer usable; it has been closed.
</span></span></span><span class=line><span class=cl><span class=c1>// The wrapped bucket should be closed when done.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>defer</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Bucket operations will ignore the passed-in key and always reference foo.txt.
</span></span></span></code></pre></div><p>Alternatively, you can configure the single key directly in the <code>blob.OpenBucket</code>
URL:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/blob&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Connect to a bucket using a URL, using the &#34;key&#34; query parameter to
</span></span></span><span class=line><span class=cl><span class=c1>// make the bucket always reference that key.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>b</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>blob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;mem://?key=foo.txt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>b</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Bucket operations will ignore the passed-in key and always reference foo.txt.
</span></span></span></code></pre></div><p>The resulting bucket will ignore the <code>key</code> parameter to its functions,
and always refer to the single key. This can be useful to allow configuration
of a specific &ldquo;file&rdquo; via a single URL.</p><p><code>List</code> functions will not work on single key buckets.</p><h2 id=using>Using a Bucket<a class=anchor href=#using aria-label="Link to Section">ðŸ”—</a></h2><p>Once you have opened a bucket for the storage provider you want, you can
store and access data from it using the standard Go I/O patterns described
below. Other operations like listing and reading metadata are documented in the
<a href=https://godoc.org/github.com/sraphs/gdk/blob><code>blob</code> package documentation</a>.</p><h3 id=writing>Writing Data to a Bucket<a class=anchor href=#writing aria-label="Link to Section">ðŸ”—</a></h3><p>To write data to a bucket, you create a writer, write data to it, and then
close the writer. Closing the writer commits the write to the provider,
flushing any buffers, and releases any resources used while writing, so you
must always check the error of <code>Close</code>.</p><p>The writer implements <a href=https://golang.org/pkg/io/#Writer><code>io.Writer</code></a>, so you can use any functions that take
an <code>io.Writer</code> like <code>io.Copy</code> or <code>fmt.Fprintln</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Open the key &#34;foo.txt&#34; for writing with the default options.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>NewWriter</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;foo.txt&#34;</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>_</span><span class=p>,</span> <span class=nx>writeErr</span> <span class=o>:=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintln</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;Hello, World!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// Always check the return value of Close when writing.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>closeErr</span> <span class=o>:=</span> <span class=nx>w</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>writeErr</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>writeErr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>closeErr</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>closeErr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In some cases, you may want to cancel an in-progress write to avoid the blob
being created or overwritten. A typical reason for wanting to cancel a write
is encountering an error in the stream your program is copying from. To abort
a write, you cancel the <code>Context</code> you pass to the writer. Again, you must
always <code>Close</code> the writer to release the resources, but in this case you can
ignore the error because the write&rsquo;s failure is expected.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Create a cancelable context from the existing context.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>writeCtx</span><span class=p>,</span> <span class=nx>cancelWrite</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>WithCancel</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nf>cancelWrite</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Open the key &#34;foo.txt&#34; for writing with the default options.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>w</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>NewWriter</span><span class=p>(</span><span class=nx>writeCtx</span><span class=p>,</span> <span class=s>&#34;foo.txt&#34;</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Assume some writes happened and we encountered an error.
</span></span></span><span class=line><span class=cl><span class=c1>// Now we want to abort the write.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// First cancel the context.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nf>cancelWrite</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1>// You must still close the writer to avoid leaking resources.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>w</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=reading>Reading Data from a Bucket<a class=anchor href=#reading aria-label="Link to Section">ðŸ”—</a></h3><p>Once you have written data to a bucket, you can read it back by creating a
reader. The reader implements <a href=https://golang.org/pkg/io/#Reader><code>io.Reader</code></a>, so you can use any functions
that take an <code>io.Reader</code> like <code>io.Copy</code> or <code>io/ioutil.ReadAll</code>. You must
always close a reader after using it to avoid leaking resources.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Open the key &#34;foo.txt&#34; for reading with the default options.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>r</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>NewReader</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;foo.txt&#34;</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>// Readers also have a limited view of the blob&#39;s metadata.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Content-Type:&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nf>ContentType</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>// Copy from the reader to stdout.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>io</span><span class=p>.</span><span class=nf>Copy</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span><span class=p>,</span> <span class=nx>r</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Many storage providers provide efficient random-access to data in buckets. To
start reading from an arbitrary offset in the blob, use <code>NewRangeReader</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Open the key &#34;foo.txt&#34; for reading at offset 1024 and read up to 4096 bytes.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>r</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>NewRangeReader</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;foo.txt&#34;</span><span class=p>,</span> <span class=mi>1024</span><span class=p>,</span> <span class=mi>4096</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>// Copy from the read range to stdout.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>io</span><span class=p>.</span><span class=nf>Copy</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span><span class=p>,</span> <span class=nx>r</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=deleting>Deleting a Bucket<a class=anchor href=#deleting aria-label="Link to Section">ðŸ”—</a></h3><p>You can delete blobs using the <code>Bucket.Delete</code> method.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>Delete</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;foo.txt&#34;</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=services>Supported Storage Services<a class=anchor href=#services aria-label="Link to Section">ðŸ”—</a></h2><h3 id=s3>S3<a class=anchor href=#s3 aria-label="Link to Section">ðŸ”—</a></h3><p>S3 URLs in the Go CDK closely resemble the URLs you would see in the <a href=https://aws.amazon.com/cli/>AWS CLI</a>.
You should specify the <code>region</code> query parameter to ensure your application
connects to the correct region.</p><p>If you set the &ldquo;awssdk=v1&rdquo; query parameter,
<code>blob.OpenBucket</code> will create a default AWS Session with the
<code>SharedConfigEnable</code> option enabled; if you have authenticated with the AWS CLI,
it will use those credentials. See <a href=https://docs.aws.amazon.com/sdk-for-go/api/aws/session/>AWS Session</a> to learn about authentication
alternatives, including using environment variables.</p><p>If you set the &ldquo;awssdk=v2&rdquo; query parameter, it will instead create an AWS
Config based on the AWS SDK V2; see <a href=https://aws.github.io/aws-sdk-go-v2/docs/configuring-sdk/>AWS V2 Config</a> to learn more.</p><p>If no &ldquo;awssdk&rdquo; query parameter is set, Go CDK will use a default (currently V1).</p><p>Full details about acceptable URLs can be found under the API reference for
<a href=https://godoc.org/github.com/sraphs/gdk/blob/s3blob#URLOpener><code>s3blob.URLOpener</code></a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/blob&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/blob/s3blob&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// blob.OpenBucket creates a *blob.Bucket from a URL.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>bucket</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>blob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;s3://my-bucket?region=us-west-1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Forcing AWS SDK V2.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>bucket</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>blob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;s3://my-bucket?region=us-west-1&amp;awssdk=2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span></code></pre></div><h4 id=s3-ctor>S3 Constructor<a class=anchor href=#s3-ctor aria-label="Link to Section">ðŸ”—</a></h4><p>The <a href=https://godoc.org/github.com/sraphs/gdk/blob/s3blob#OpenBucket><code>s3blob.OpenBucket</code></a> constructor opens an <a href=https://aws.amazon.com/s3/>S3</a> bucket:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/aws/aws-sdk-go-v2/config&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/aws/aws-sdk-go-v2/service/s3&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/blob/s3blob&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Establish a AWS V2 Config.
</span></span></span><span class=line><span class=cl><span class=c1>// See https://aws.github.io/aws-sdk-go-v2/docs/configuring-sdk/ for more info.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>ctx</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>cfg</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>config</span><span class=p>.</span><span class=nf>LoadDefaultConfig</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create a *blob.Bucket.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>client</span> <span class=o>:=</span> <span class=nx>s3</span><span class=p>.</span><span class=nf>NewFromConfig</span><span class=p>(</span><span class=nx>cfg</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>bucket</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s3blob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>client</span><span class=p>,</span> <span class=s>&#34;my-bucket&#34;</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span></code></pre></div><h4 id=s3-compatible>S3-Compatible Servers<a class=anchor href=#s3-compatible aria-label="Link to Section">ðŸ”—</a></h4><p>The Go CDK can also interact with <a href=https://en.wikipedia.org/wiki/Amazon_S3#S3_API_and_competing_services>S3-compatible storage servers</a> that
recognize the same REST HTTP endpoints as S3, like <a href=https://www.minio.io/>Minio</a>, <a href=https://ceph.com/>Ceph</a>, or
<a href=https://github.com/chrislusf/seaweedfs>SeaweedFS</a>. You can change the endpoint by changing the <a href=https://godoc.org/github.com/aws/aws-sdk-go/aws#Config.Endpoint><code>Endpoint</code> field</a>
on the <code>*aws.Config</code> you pass to <code>s3blob.OpenBucket</code>. If you are using
<code>blob.OpenBucket</code>, you can switch endpoints by using the S3 URL using query
parameters like so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>bucket</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>blob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=s>&#34;s3://mybucket?&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;endpoint=my.minio.local:8080&amp;&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;disableSSL=true&amp;&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;s3ForcePathStyle=true&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>See <a href=https://godoc.org/github.com/sraphs/gdk/aws#ConfigFromURLParams><code>aws.ConfigFromURLParams</code></a> for more details on supported URL options for S3.</p><h3 id=local>Local Storage<a class=anchor href=#local aria-label="Link to Section">ðŸ”—</a></h3><p>The Go CDK provides blob drivers for storing data in memory and on the local
filesystem. These are primarily intended for testing and local development,
but may be useful in production scenarios where an NFS mount is used.</p><p>Local storage URLs take the form of either <code>mem://</code> or <code>file:///</code> URLs.
Memory URLs are always <code>mem://</code> with no other information and always create a
new bucket. File URLs convert slashes to the operating system&rsquo;s native file
separator, so on Windows, <code>C:\foo\bar</code> would be written as
<code>file:///C:/foo/bar</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;github.com/sraphs/gdk/blob&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/blob/fileblob&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>_</span> <span class=s>&#34;github.com/sraphs/gdk/blob/memblob&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>bucket1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>blob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;mem://&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>bucket1</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>bucket2</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>blob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;file:///path/to/dir&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>bucket2</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span></code></pre></div><h4 id=local-ctor>Local Storage Constructors<a class=anchor href=#local-ctor aria-label="Link to Section">ðŸ”—</a></h4><p>You can create an in-memory bucket with <a href=https://godoc.org/github.com/sraphs/gdk/blob/memblob#OpenBucket><code>memblob.OpenBucket</code></a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/blob/memblob&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create an in-memory bucket.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>bucket</span> <span class=o>:=</span> <span class=nx>memblob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Now we can use bucket to read or write files to the bucket.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>err</span> <span class=o>:=</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>WriteAll</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;my-key&#34;</span><span class=p>,</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>),</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>data</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>ReadAll</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;my-key&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nb>string</span><span class=p>(</span><span class=nx>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Output:
</span></span></span><span class=line><span class=cl><span class=c1>// hello world
</span></span></span></code></pre></div><p>You can use a local filesystem directory with <a href=https://godoc.org/github.com/sraphs/gdk/blob/fileblob#OpenBucket><code>fileblob.OpenBucket</code></a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/sraphs/gdk/blob/fileblob&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The directory you pass to fileblob.OpenBucket must exist first.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>const</span> <span class=nx>myDir</span> <span class=p>=</span> <span class=s>&#34;path/to/local/directory&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>MkdirAll</span><span class=p>(</span><span class=nx>myDir</span><span class=p>,</span> <span class=mo>0777</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create a file-based bucket.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>bucket</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>fileblob</span><span class=p>.</span><span class=nf>OpenBucket</span><span class=p>(</span><span class=nx>myDir</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>bucket</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span></code></pre></div></div></main><nav class=Sidenav><ul class=Sidenav-list><li class=Sidenav-section><a href=../../ class=Sidenav-sectionLink>Home</a></li><li class=Sidenav-section><a href=../../howto/ class=Sidenav-sectionLink>How-To Guides</a><ul class=Sidenav-pageList><li class=Sidenav-page><a href=../../howto/blob/ class=Sidenav-pageLink>Blob</a></li><li class=Sidenav-page><a href=../../howto/pubsub/ class=Sidenav-pageLink>Pub/Sub</a></li><li class=Sidenav-page><a href=../../howto/runtimevar/ class=Sidenav-pageLink>Runtime Configuration</a></li><li class=Sidenav-page><a href=../../howto/secrets/ class=Sidenav-pageLink>Secrets</a></li></ul></li><li class=Sidenav-section><a href=../../concepts/ class=Sidenav-sectionLink>Concepts</a><ul class=Sidenav-pageList><li class=Sidenav-page><a href=../../concepts/structure/ class=Sidenav-pageLink>Structuring Portable Code</a></li><li class=Sidenav-page><a href=../../concepts/urls/ class=Sidenav-pageLink>URLs</a></li><li class=Sidenav-page><a href=../../concepts/as/ class=Sidenav-pageLink>Using provider-specific APIs</a></li></ul></li></ul></nav><footer class=PageFooter><nav><ul class=FooterLinks><li class=FooterLinks-item><a href=https://github.com/sraphs/gdk/ class=FooterLinks-link>GitHub</a></li><li class=FooterLinks-item><a href=https://github.com/sraphs/gdk/issues class=FooterLinks-link>Contact Team</a></li></ul></nav><p class=PageFooter-paragraph>Copyright Â© 2022-2022 The Go Development Kit Authors.
All content released under an <a href=https://github.com/sraphs/gdk/main/LICENSE target=_blank class=PageFooter-link>Apache 2.0 License</a>.</p><p class=PageFooter-paragraph><a href=https://github.com/sraphs/gdk/main/internal/website/content/howto/blob/_index.md class=PageFooter-link>Improve this page</a> on GitHub.</p></footer></div></body></html>